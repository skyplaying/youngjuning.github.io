---
title: åŸºäº Probot å®ç° GitHub NPM å‘å¸ƒæœºå™¨äººğŸ¤–
cover:
tags: [æ˜é‡‘ä¸“æ ]
---

> æ€•ä»€ä¹ˆçœŸç†æ— ç©·ï¼Œè¿›ä¸€å¯¸æœ‰ä¸€å¯¸çš„æ¬¢å–œã€‚å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯[@æ´›ç«¹](https://github.com/youngjuning)ï¼Œä¸€åçƒ­çˆ±ç¼–ç¨‹ã€çƒ­çˆ±ç”Ÿæ´»çš„ç»ˆèº«å­¦ä¹ å®è·µè€…ã€‚

## å…³äº Github Apps

GitHub Apps æ˜¯ GitHub ä¸­ä¼˜ç§€çš„äº§å“ã€‚ä¸€ä¸ª GitHub App ä»¥è‡ªå·±çš„åä¹‰è¡Œäº‹ï¼Œé€šè¿‡ API ç›´æ¥ä½¿ç”¨è‡ªå·±çš„èº«ä»½è¿›è¡Œæ“ä½œï¼Œè¿™æ„å‘³ç€ä½ ä¸éœ€è¦ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç”¨æˆ·ç»´æŠ¤ä¸€ä¸ªæœºå™¨äººæˆ–æœåŠ¡è´¦æˆ·ã€‚

GitHub Apps å¯ä»¥è¢«ç›´æ¥å®‰è£…åˆ°ç»„ç»‡æˆ–è€…ç”¨æˆ·è´¦å·ä¸Šï¼Œå¹¶ä¸”å¯ä»¥èµ‹äºˆå®ƒä»¬è®¿é—®æŒ‡å®šä»“åº“çš„æƒé™ã€‚å®ƒä»¬å¸¦æœ‰å†…ç½®çš„ webhook å’Œç‹­çª„çš„ç‰¹å®šæƒé™ã€‚è®¾ç½® GitHub åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥é€‰æ‹©å¸Œæœ›å®ƒè®¿é—®çš„ä»“åº“ã€‚æ¯”å¦‚ä½ å¯ä»¥è®¾ç½®ä¸€ä¸ªå« `MyGitHub` çš„åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºæœ‰ä¸”ä»…æœ‰ `octocat` ä»“åº“çš„å†™å…¥ `issues` çš„æƒé™ã€‚å®‰è£… GitHub App éœ€è¦ä½ æ˜¯ç»„ç»‡çš„æ‰€æœ‰è€…æˆ–å¯¹ä»“åº“æ‹¥æœ‰ admin æƒé™ã€‚

## å…³äº Probot

Probot æ˜¯ä¸€ä¸ªåŸºäº Node.js æ„å»º GitHub Apps çš„æ¡†æ¶ã€‚å®ƒæ—¨åœ¨æ¶ˆé™¤æ‰€æœ‰ç¹ççš„äº‹æƒ…ï¼Œå¦‚æ¥æ”¶å’ŒéªŒè¯ webhooks ä»¥åŠåšè®¤è¯åŠ¨ä½œï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä¸“æ³¨äºä½ æƒ³è¦å®ç°çš„åŠŸèƒ½ã€‚Probot åº”ç”¨ç¨‹åºéå¸¸å®¹æ˜“ç¼–å†™ã€éƒ¨ç½²å’Œåˆ†äº«ã€‚å¤§å¤šæ•°æµè¡Œçš„ Probot åº”ç”¨è¢«æ‰˜ç®¡ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦åšä»»ä½•éƒ¨ç½²å’Œç®¡ç†å·¥ä½œã€‚è¿™é‡Œæœ‰å‡ ä¸ªåŸºäº Probot æ„å»ºçš„åº”ç”¨ï¼š

- [ESLint Disable Watcher][eslint-disable] - å½“ pr ä¸­å°è¯•ç¦ç”¨ eslint è§„åˆ™æ—¶è¿›è¡Œè¯„è®ºã€‚
- [Developer Certificate of Origin][dco] - å¼ºåˆ¶ Pull Requests ç¬¦åˆ DCO è§„èŒƒ
- [Issue Check][issue-check] - æ ¹æ®å…³é”®å­—å’Œä»»åŠ¡åˆ—è¡¨æ£€æŸ¥ issues ä»¥ç¡®ä¿åŒ…å«å¿…è¦çš„ä¿¡æ¯
- [Pull][pull] - Keep your forks up-to-date.

ä½ å¯ä»¥åœ¨[ç‰¹è‰²åº”ç”¨][featured-apps]æˆ–[GitHub probot-app è¯é¢˜][github-probot-app-topics]æµè§ˆæ›´å¤šåº”ç”¨ã€‚

## Hello Probot

ä¸€ä¸ª Probot åº”ç”¨æœ¬è´¨ä¸Šæ˜¯å¯¼å‡ºä¸€ä¸ªå‡½æ•°çš„ [Node.js æ¨¡å—][node-modules]ï¼š

```ts
module.exports = app => {
  // your code here
};
```

`app` å‚æ•°æ˜¯ [Probot][probot-class] ç±»çš„å®ä¾‹ï¼Œè¯¥å®ä¾‹å¯ä»¥è®©ä½ è®¿é—®æ‰€æœ‰çš„ GitHub ç²¾åã€‚

`aap.on` è´Ÿè´£ç›‘å¬æ‰€æœ‰ [GitHub è§¦å‘çš„ webhook äº‹ä»¶][webhooks]ï¼Œå½“ GitHub ä¸Šå‘ç”Ÿä»»ä½•æœ‰è¶£çš„äº‹æƒ…ï¼Œä½ çš„åº”ç”¨ç¨‹åºæƒ³çŸ¥é“çš„æ—¶å€™ï¼Œå®ƒä¼šé€šçŸ¥ä½ ã€‚

```ts
module.exports = app => {
  app.on('issues.opened', async context => {
    // ä¸€ä¸ªæ–°çš„ issue è¢«æ‰“å¼€ï¼Œæˆ‘ä»¬åº”è¯¥åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ
    context.log.info(context.payload);
  });
};
```

ä¼ é€’ç»™äº‹ä»¶å¤„ç†ç¨‹åºçš„ä¸Šä¸‹æ–‡åŒ…æ‹¬å…³äºè¢«è§¦å‘çš„äº‹ä»¶çš„ä¸€åˆ‡ï¼Œä»¥åŠä¸€äº›æœ‰ç”¨çš„å±æ€§ï¼Œä»¥ä¾¿å¯¹äº‹ä»¶åšå‡ºæœ‰ç”¨çš„å›åº”ã€‚`context.octokit` æ˜¯ä¸€ä¸ªç»è¿‡è®¤è¯çš„ GitHub å®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”¨æ¥[è¿›è¡Œ REST API å’Œ GraphQL è°ƒç”¨][github-api]ï¼Œå¹¶å…è®¸ä½ ä»¥ç¼–ç¨‹æ–¹å¼åšå‡ ä¹ä»»ä½•ä½ å¯ä»¥åœ¨ GitHub ä¸Šé€šè¿‡æµè§ˆå™¨åšçš„äº‹æƒ…ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå½“æ–°æ‰“å¼€ issues æ—¶è‡ªåŠ¨è¯„è®ºçš„ Appã€‚

```ts
module.exports = app => {
  app.on('issues.opened', async context => {
    // context` ä»äº‹ä»¶ä¸­æå–ä¿¡æ¯ï¼Œå¯ä»¥ä¼ é€’ç»™ GitHub API è°ƒç”¨ã€‚è¿™å°†è¿”å›ï¼š
    // { owner: 'yourname', repo: 'yourrepo', number: 123, body: 'Hello World !}
    const params = context.issue({ body: 'Hello World!' });

    // åœ¨ issue ä¸Šå‘ä¸€æ¡è¯„è®º
    return context.octokit.issues.createComment(params);
  });
};
```

## å¼€å‘ä¸€ä¸ª Probot app

ä¸ºäº†å¼€å‘ä¸€ä¸ª Probot appï¼Œä½ é¦–å…ˆéœ€è¦å®‰è£… Node.js 10.0.0 æˆ–æ›´æ–°çš„ç‰ˆæœ¬ã€‚

### ç”Ÿæˆä¸€ä¸ªæ–°çš„ app

[create-probot-app][create-probot-app] æ˜¯å¼€å§‹æ„å»ºä¸€ä¸ªæ–°çš„ app çš„æœ€ä½³æ–¹å¼ã€‚å®ƒå°†ç”Ÿæˆä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«ä½ æ‰€éœ€è¦çš„ä¸€åˆ‡ï¼Œä»¥å¼€å§‹å¹¶åœ¨ç”Ÿäº§ä¸­è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºã€‚

è¿è¡Œä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆä¸€ä¸ªé¡¹ç›®ï¼š

```sh
$ npx create-probot-app my-first-app
```

è¯¥å‘½ä»¤ä¼šé—®ä¸€ç³»åˆ—å…³äºä½ çš„ app çš„é—®é¢˜ï¼Œçœ‹èµ·æ¥å°±åƒï¼š

```sh
Let's create a Probot app!
? App name: my-first-app
? Description of app: A 'Hello World' GitHub App built with Probot.
? Author's full name: Katie Horne
? Author's email address: katie@auth0.com
? GitHub user or org name: khorne3
? Repository name: my-first-app
? Which template would you like to use? (Use arrow keys)
â¯ basic-js
  basic-ts (use this one for TypeScript support)
  checks-js
  git-data-js
  deploy-js

Finished scaffolding files!

Installing dependencies. This may take a few minutes...

Successfully created my-first-app.

Begin using your app with:
  cd my-first-app
  npm start

View your app's README for more usage instructions.

Visit the Probot docs:
  https://probot.github.io/docs/

Get help from the community:
  https://probot.github.io/community/

Enjoy building your Probot app!
```

åˆ›å»ºçš„æœ€é‡è¦çš„æ–‡ä»¶æ˜¯ `index.js`ï¼ˆä½ çš„ app ä»£ç æ‰€åœ¨çš„ä½ç½®ï¼‰å’Œ `package.json`ï¼ˆä½¿ä½ çš„ app æˆä¸ºæ ‡å‡† [npm module][npm-module]ï¼‰ã€‚

### æœ¬åœ°è¿è¡Œ app

ç°åœ¨ä½ å·²ç»å‡†å¤‡å¥½åœ¨æœ¬åœ°è¿è¡Œ app äº†ã€‚è¿è¡Œ `npm start` æ¥å¼€å¯ä¸€ä¸ª server å§ï¼š

> æ³¨æ„ï¼šå¦‚æœä½ é€‰æ‹©äº† TypeScript æ¨¡æ¿ï¼Œè¯·ç¡®ä¿æ‰§è¡Œäº† `npm run build`ï¼

```sh
$ yarn start
yarn run v1.22.10
$ probot run ./lib/index.js
INFO (server): Running Probot v11.3.0 (Node.js: v14.15.5)
INFO (server): Forwarding https://smee.io/dz7D1zur24cGNj7 to http://localhost:3000/
INFO (server): Listening on http://localhost:3000
INFO (server): Connected
```

### é…ç½® GitHub App

ä¸‹åˆ—æ˜¯è‡ªåŠ¨é…ç½® GitHub App çš„æ­¥éª¤ï¼š

1. åœ¨æœ¬åœ°å‘½ä»¤è¡Œä¸­æ‰§è¡Œ `npm start`ã€‚
2. è®¿é—® http://localhost:3000 æŸ¥çœ‹ä¸‹ä¸€æ­¥ã€‚
3. ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„é¡µé¢ã€‚

![](https://cdn.jsdelivr.net/gh/youngjuning/images/20210519200016.png)

4. ç‚¹å‡» **Register a GitHub App** æŒ‰é’®ç»§ç»­ã€‚
5. æ¥ç€ï¼Œä½ éœ€è¦ç»™ä½ çš„ App å–ä¸€ä¸ªæ²¡æœ‰è¢«å ç”¨çš„åå­—ï¼Œæ³¨æ„ï¼šå¦‚æœä½ çœ‹åˆ°ç±»ä¼¼ `Name is reserved for the account @tuya` çš„æç¤ºï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½ä½¿ç”¨å·²å­˜åœ¨çš„ GitHub organization çš„åå­—ä½œä¸º app çš„åå­—ï¼ˆé™¤éä½ æ˜¯è¯¥ç»„ç»‡çš„ ownerï¼‰

## Github Release çŠ¶æ€å˜åŒ–

![](https://cdn.jsdelivr.net/gh/youngjuning/images/20210520153504.png)

[probot]: https://probot.github.io/
[github apps]: https://docs.github.com/en/developers/apps/about-apps
[web æŒ‚é’©äº‹ä»¶å’Œæœ‰æ•ˆè´Ÿè½½]: https://docs.github.com/cn/developers/webhooks-and-events/webhooks/webhook-events-and-payloads
[marketplace-getting-started]: https://docs.github.com/en/marketplace/getting-started
[eslint-disable]: https://probot.github.io/apps/eslint-disable/
[dco]: https://probot.github.io/apps/dco/
[issue-check]: https://probot.github.io/apps/issue-check/
[pull]: https://probot.github.io/apps/pull/
[featured-apps]: https://probot.github.io/apps/
[github-probot-app-topics]: https://github.com/search?q=topic%3Aprobot-app&type=Repositories
[node-modules]: https://nodejs.org/api/modules.html
[probot-class]: https://probot.github.io/api/latest/classes/probot.html
[webhooks]: https://probot.github.io/docs/webhooks/
[github-api]: https://probot.github.io/docs/github-api/
[create-probot-app]: https://github.com/probot/create-probot-app
[npm-module]: https://docs.npmjs.com/files/package.json

## ç»“è¯­

å…³æ³¨å…¬ä¼—å·`æ´›ç«¹æ—©èŒ¶é¦†`ï¼Œä¸€ä¸ªæŒç»­åˆ†äº«ç¼–ç¨‹çŸ¥è¯†çš„åœ°æ–¹ã€‚

- `ç‚¹èµ`ç­‰äºå­¦ä¼šï¼Œ`åœ¨çœ‹`ç­‰äºç²¾é€š
- æœ€åç¥å¤§å®¶ 2021 å­¦ä¹ è¿›æ­¥ï¼Œå‡èŒåŠ è–ª

> æœ¬æ–‡é¦–å‘äºã€Œ[æ´›ç«¹çš„å®˜æ–¹ç½‘ç«™](https://youngjuning.js.org/)ã€ï¼ŒåŒæ­¥äºå…¬ä¼—å·ã€Œ[æ´›ç«¹æ—©èŒ¶é¦†](https://cdn.jsdelivr.net/gh/youngjuning/images/20210418112129.jpeg)ã€å’Œã€Œ[æ˜é‡‘ä¸“æ ](https://juejin.cn/user/325111174662855)ã€ã€‚

![](https://youngjuning.js.org/img/luozhu.png)
