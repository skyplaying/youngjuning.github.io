<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta name="title" content="洛竹的官方网站" />
    <meta name="keywords" content="react, javascript, typescript" />
    <meta name="description" content="怕什么真理无穷，进一寸有一寸的欢喜" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://i.loli.net/2021/01/07/LkH3VM6oBnIuFNi.png"
    />
    <link rel="stylesheet" href="/umi.26fedac2.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.3.9
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.includes(e) ? e : r[0]
        );
      })();
    </script>
    <title>Rust 编写猜数游戏</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/blog/rust/rust 编写猜数游戏" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;https://i.loli.net/2021/01/07/LkH3VM6oBnIuFNi.png&#x27;)" href="/">洛竹的官方网站</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a aria-current="page" class="active" href="/blog">博客</a></span><span><a href="/awesome">收藏</a></span><span><a href="/about">关于</a></span><span><a href="/leetcode">算法</a></span><span><a href="/links">友链</a></span><span>洛竹文档⤵️<ul><li><a href="/cobra"> Cobra</a></li><li><a href="/viper"> Viper</a></li><li><a href="/github-actions"> GitHub Actions</a></li></ul></span><span><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/user/325111174662855/posts">掘金<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><span><a target="_blank" rel="noopener noreferrer" href="https://www.zhihu.com/people/yangjunning">知乎<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><ul><li><a target="_blank" rel="noopener noreferrer" href="https://www.zhihu.com/column/c_1341734653628149760">前端早茶馆<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/youngjuning.github.io">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://i.loli.net/2021/01/07/LkH3VM6oBnIuFNi.png&#x27;)" href="/"></a><h1>洛竹的官方网站</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a aria-current="page" class="active" href="/blog">博客</a></li><li><a href="/awesome">收藏</a></li><li><a href="/about">关于</a></li><li><a href="/leetcode">算法</a></li><li><a href="/links">友链</a></li><li>洛竹文档⤵️<ul><li><a href="/cobra"> Cobra</a></li><li><a href="/viper"> Viper</a></li><li><a href="/github-actions"> GitHub Actions</a></li></ul></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/user/325111174662855/posts">掘金<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.zhihu.com/people/yangjunning">知乎<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><ul><li><a target="_blank" rel="noopener noreferrer" href="https://www.zhihu.com/column/c_1341734653628149760">前端早茶馆<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/youngjuning.github.io">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/blog">Less is more</a></li><li><a href="/blog/deno">Deno</a><ul><li><a href="/blog/deno/deno git-hub action 源码解析"><span>Deno GitHub Action 源码解析</span></a></li><li><a href="/blog/deno/向 deno 学习脚本的管理"><span>向 Deno 学习脚本的管理</span></a></li></ul></li><li><a href="/blog/devops">Devops</a><ul><li><a href="/blog/devops/玩转 github actions"><span>玩转 GitHub Actions</span></a></li></ul></li><li><a href="/blog/go">Go</a><ul><li><a href="/blog/go/go语法学习笔记"><span>Go 语法学习笔记</span></a></li><li><a href="/blog/go/基于 go 实现 deno upgrade"><span>基于 Go 实现 Deno upgrade</span></a></li><li><a href="/blog/go/极速入门 go 并爬取掘金专栏"><span>极速入门 Go 并爬取掘金专栏</span></a></li></ul></li><li><a href="/blog/javascript">Javascript</a><ul><li><a href="/blog/javascript/使用jest和enzyme进行react native单元测试"><span>使用Jest和Enzyme进行React Native单元测试</span></a></li><li><a href="/blog/javascript/图解google-v8-学习笔记"><span>图解 Google V8 学习笔记</span></a></li></ul></li><li><a href="/blog/others">Others</a><ul><li><a href="/blog/others/程序员购钻指南"><span>程序员购钻指南：钻戒值不值得买？怎么买？</span></a></li></ul></li><li><a href="/blog/react-native">react-native</a><ul><li><a href="/blog/react-native/flutter-vs-react-native–what-to-choose-in-2021"><span>2021 Flutter 完胜 React Native ?</span></a></li><li><a href="/blog/react-native/react native 调试最佳实践"><span>React Native 调试最佳实践</span></a></li><li><a href="/blog/react-native/当我们在聊 rn 时，我们在谈什么"><span>当我们在聊 RN 时，我们在聊什么|技术点评</span></a></li><li><a href="/blog/react-native/给 react native 库添加 example"><span>给 React Native 库添加 Example</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog/rust">Rust</a><ul><li><a href="/blog/rust/一个番茄钟入门 rust"><span>一个番茄钟入门 Rust</span></a></li><li><a href="/blog/rust/rust 语法学习"><span>Rust 语法学习</span></a></li><li><a aria-current="page" class="active" href="/blog/rust/rust 编写猜数游戏"><span>Rust 编写猜数游戏</span></a></li><li><a href="/blog/rust/为什么rust需要局部变量隐藏"><span>为什么 Rust 需要局部变量隐藏</span></a></li><li><a href="/blog/rust/rust 在 web 领域的应用"><span>Rust 在 Web 领域的应用</span></a></li></ul></li><li><a href="/blog/tools">Tools</a><ul><li><a href="/blog/tools/发布一个 homebrew 包"><span>发布一个 Homebrew 包</span></a></li><li><a href="/blog/tools/我的mac开发环境"><span>我的 Mac 开发环境</span></a></li></ul></li><li><a href="/blog/typescript">Typescript</a><ul><li><a href="/blog/typescript/向微软官方贡献 @types 包"><span>向微软官方贡献 @types 包</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="环境" data-depth="2"><a href="/blog/rust/rust 编写猜数游戏#环境"><span>环境</span></a></li><li title="处理用户输入" data-depth="2"><a href="/blog/rust/rust 编写猜数游戏#处理用户输入"><span>处理用户输入</span></a></li><li title="声明导入" data-depth="3"><a href="/blog/rust/rust 编写猜数游戏#声明导入"><span>声明导入</span></a></li><li title="使用变量来存储值" data-depth="3"><a href="/blog/rust/rust 编写猜数游戏#使用变量来存储值"><span>使用变量来存储值</span></a></li><li title="处理可能失败的情况" data-depth="3"><a href="/blog/rust/rust 编写猜数游戏#处理可能失败的情况"><span>处理可能失败的情况</span></a></li><li title="通过 println! 中的占位符输出对应的值" data-depth="3"><a href="/blog/rust/rust 编写猜数游戏#通过-println-中的占位符输出对应的值"><span>通过 println! 中的占位符输出对应的值</span></a></li><li title="尝试运行代码" data-depth="3"><a href="/blog/rust/rust 编写猜数游戏#尝试运行代码"><span>尝试运行代码</span></a></li><li title="生成一个保密数字" data-depth="2"><a href="/blog/rust/rust 编写猜数游戏#生成一个保密数字"><span>生成一个保密数字</span></a></li><li title="引入 rand 包" data-depth="3"><a href="/blog/rust/rust 编写猜数游戏#引入-rand-包"><span>引入 rand 包</span></a></li><li title="生成一个随机数" data-depth="3"><a href="/blog/rust/rust 编写猜数游戏#生成一个随机数"><span>生成一个随机数</span></a></li><li title="比较猜测数字与保密数字" data-depth="2"><a href="/blog/rust/rust 编写猜数游戏#比较猜测数字与保密数字"><span>比较猜测数字与保密数字</span></a></li><li title="使用循环来实现多次猜测" data-depth="2"><a href="/blog/rust/rust 编写猜数游戏#使用循环来实现多次猜测"><span>使用循环来实现多次猜测</span></a></li><li title="处理非法输入" data-depth="2"><a href="/blog/rust/rust 编写猜数游戏#处理非法输入"><span>处理非法输入</span></a></li></ul><div class="__dumi-default-layout-content"><span class="__dumi-default-badge">掘金专栏</span><div style="display:flex;justify-content:center"><img src="https://i.loli.net/2021/02/15/TSfMxtmOLvqcn7w.png" width="70%"/></div><div class="markdown"><blockquote><p>本文首发于洛竹的官方网站，欢迎光临小站。</p></blockquote><blockquote><p>猜数游戏代码在 <a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/learn-rust/tree/master/guessing_game">guessing_game<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，欢迎 clone。</p></blockquote><blockquote><p>本文是番茄钟学 Rust 系列的第三篇，该系列文章目前共有：</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/6928656425090547726">一个番茄钟入门 Rust<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/6929080722565267469">两个番茄钟的 Rust 语法学习<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/6929485407621120013">Rust 编写猜数游戏|一个半番茄钟<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></blockquote><p>这两天洛竹被人喷太菜，文章还到处发 😭。在这里对大家说抱歉了，我道歉的点是不该为了曝光率转发到各个前端群，这笔记我还是会坚持写，坚持发出来给大家看。——虽菜但瘾</p><p>经过两天的思考以及大佬解惑之后，我悟出的真谛是：**学习新技能最好的状态是有兴趣、有地方分享以及有志同道合的人一起交流。**文末有 Rust 交流群二维码，欢迎加入我们。</p><blockquote><p>为了方便大家学习，需要运行（<code>cargo run</code>）看效果的地方，我都截了 GIF 图。喜欢的话可以给洛竹个 👍🏻 鼓励一下。</p></blockquote><h2 id="环境"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#环境"><span class="icon icon-link"></span></a>环境</h2><blockquote><ul><li><p>rustc：<code>1.50.0 (cb75ad5db 2021-02-10)</code></p></li><li><p>cargo：<code>1.50.0 (f04e7fab7 2021-02-04)</code></p></li><li><p><code>rand</code> crate：<code>0.8.3</code></p></li><li><p>vscode plugins</p><ul><li>Better TOML</li><li>CodeLLDB</li><li>crates</li><li>rust-analyzer</li></ul></li><li><p>oh-my-zsh theme：ys</p></li><li><p>截图软件：<a target="_blank" rel="noopener noreferrer" href="https://getkap.co/">Kap<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul></blockquote><h2 id="处理用户输入"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#处理用户输入"><span class="icon icon-link"></span></a>处理用户输入</h2><p>猜数游戏第一部分会请求用户进行输入，上代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-rust"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">use std::io;</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">fn main() {</span></div><div class="token-line"><span class="token plain">    println!(&quot;Guess the number!&quot;);</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    println!(&quot;Please input your guess.&quot;);</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    let mut guess = String::new();</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    io::stdin()</span></div><div class="token-line"><span class="token plain">        .read_line(&amp;mut guess)</span></div><div class="token-line"><span class="token plain">        .expect(&quot;Failded to read line&quot;);</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    println!(&quot;You guessed: {}&quot;, guess);</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><h3 id="声明导入"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#声明导入"><span class="icon icon-link"></span></a>声明导入</h3><ul><li><code>use std::io;</code> 语句：把标准库（<a target="_blank" rel="noopener noreferrer" href="https://github.com/rust-lang/rust/tree/master/library/std/src/io">std<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）中的 <code>io</code> 模块引入当前的作用域中。</li><li>Rust 默认会将预导入（prelude）模块内的条目自动引入每一段程序的作用域中，它包含了一小部分相当常用的类型。如果你需要的模块不在预导入模块内，那么我们就必须使用 <code>use</code> 语句来显式地进行导入声明。</li><li><code>std::id</code> 库包含了许多有用的功能，我们可以使用它来获得用户的输入数据。</li></ul><h3 id="使用变量来存储值"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#使用变量来存储值"><span class="icon icon-link"></span></a>使用变量来存储值</h3><ul><li><code>let mut guess</code>：创建出一个名为 <code>guess</code> 的可变变量，变量默认是不可变的，<code>mut</code> 关键字表示可变（mutable）变量，关于变量与可变性的概念在<a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/6929080722565267469">两个番茄钟的 Rust 语法学习笔记<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中有介绍。</li><li><code>String::new</code>：返回一个新的 <code>String</code> 实例<ul><li><code>::</code> 语法表明 <code>new</code> 是 <code>String</code> 类型的一个关联函数（associated function）——其他语言中被称为静态方法（static method）</li><li><code>String</code>是标准库中的一个字符串类型，它在内部使用了 UTF-8 格式的编码并可以按照需求扩展自己的大小。</li></ul></li><li><code>io::stdin</code>：返回<code>std::io::Stdin</code> 的实例，它被用作句柄来处理终端中的标准输入。</li><li><code>.read_line</code> 方法用来获得用户输入。<ul><li><code>read_line</code> 的参数 <code>&amp;mut guess</code> 表示引用一个可变变量。</li><li><code>&amp;</code> 表示当前的参数是一个引用，这在 Go 中也是存在的。因为这些系统级编程语言大多都提供了操作内存的权限，而 JavaScript 是不给用户这些功能的。</li></ul></li></ul><blockquote><p>句柄：在上世纪 80 年代的操作系统（如 Mac OS 句柄 和 Windows）的内存管理中，句柄被广泛应用。Unix 系统的文件描述符基本上也属于句柄。和其它桌面环境一样，Windows API 大量使用句柄来标识系统中的对象)，并创建操作系统与用户空间之间的通信渠道。例如，桌面上的一个窗体由一个<code>HWND</code>类型的句柄来标识。</p></blockquote><h3 id="处理可能失败的情况"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#处理可能失败的情况"><span class="icon icon-link"></span></a>处理可能失败的情况</h3><p>我们先来看下 Go 里边的错误处理方式：</p><div class="__dumi-default-code-block"><pre class="prism-code language-go"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">func</span><span class="token plain"> </span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  result</span><span class="token punctuation">,</span><span class="token plain">err </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> err </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">panic</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  fmt</span><span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;The result is %s&quot;</span><span class="token punctuation">,</span><span class="token plain"> result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">func</span><span class="token plain"> </span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token builtin">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// some codes</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><p>一般，一个函数可能报错的话都会在返回 result 的同时返回一个 <code>error</code> 。这并不是 Go 专属的，Rust 语言中也是如此，只不过实现方式不一样。</p><p>前面代码中，<code>read_line</code> 会将用户输入的内容存储到我们传入的字符串中，但与此同时，它还会返回一个 <code>io::Result</code> 值。在 Rust 标准库中，你可以找到许多以 <code>Result</code> 命名的类型，它们通常是各个子模块中 <code>Result</code> 泛型的特定版本，比如这里的<code>io::Result</code>。</p><blockquote><p><code>Result</code> 是一个枚举类型。枚举类型由一系列固定的值组合而成，这些值被称作枚举的变体。（众所周知，Javascript 没有枚举类型）</p></blockquote><p>对于 <code>Result</code> 而言，它拥有 <code>Ok</code> 和 <code>Err</code> 两个变体。其中的 <code>Ok</code> 变体表明当前的操作执行成功，并附带代码产生的结果值。相应地，<code>Err</code> 变体则表明当前的操作执行失败，并附带引发失败的具体原因。</p><p><code>expect</code> 是 <code>Result</code> 类型的值的一系列方法中的一个。假如 <code>io::Result</code> 实例的值是 <code>Err</code>，那么 <code>expect</code> 方法就会中断当前的程序，并将传入的字符串参数显示出来。</p><blockquote><p><code>read_line</code> 方法有可能因为底层操作系统的错误而返回一个 <code>Err</code> 结果。</p><p>相应地，假如 <code>io::Result</code> 实例的值是 <code>Ok</code>，那么 <code>expect</code> 就会提取出 <code>Ok</code> 中附带的值，并将它作为结果返回给用户。在我们的例子中，这个值就是用户输入内容的字节数。</p></blockquote><p>即便我们没有在语句末尾调用 <code>expect</code>，这段程序也能够编译通过，但你会在编译过程中看到如下所示的警告信息。这一点和 Go 也基本一致。</p><img src="https://i.loli.net/2021/02/16/DEMdBhfQWHoXkr1.png" style="zoom:50%"/><img src="https://i.loli.net/2021/02/16/lMDFKNZQvBiuze8.png" style="zoom:50%"/><p>Rust 编译器提醒我们 <code>read_line</code> 方法返回的 <code>Result</code> 值还没有被处理，这通常以为着我们的程序没有对潜在的错误进行处理。</p><p>消除警告最正确的方法当然是编写对应的错误处理代码，为了简单起见，我们在这里选择使用 <code>expect</code> 方法，它会让程序在出现错误时直接终止运行并退出。</p><h3 id="通过-println-中的占位符输出对应的值"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#通过-println-中的占位符输出对应的值"><span class="icon icon-link"></span></a>通过 <code>println!</code> 中的占位符输出对应的值</h3><p><code>println!(&quot;You guessed: <!-- -->{<!-- -->}<!-- -->&quot;, guess);</code> 可以将我们存储的用户输入打印出来。这段宏调用的第一个参数是用于格式化的字符串，而字符串中的那些花括号<code>{<!-- -->}</code>则是一个占位符。</p><blockquote><p>举一反三：<code>{<!-- -->}</code> 作为占位符不是 Rust 特有的，我所知的 Shell 中也有类似的应用，比如 <code>ls | xargs -I <!-- -->{<!-- -->}<!-- --> tar zcvfm <!-- -->{<!-- -->}<!-- -->.tar.bz <!-- -->{<!-- -->}</code> 这段脚本的意思就是将 <code>ls</code> 输出的值逐个通过管道传入后面的命令，<code>{<!-- -->}</code> 便是接收管道传的值的占位符。顺便一提，这段脚本我在 <a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/tuya-panel-demo/blob/3b66bbaa45560fa247a76adc2ab06f5ca477fcc5/.github/workflows/release.yml#L20">tuya-panel-demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 有使用。这里挖个坑，后续会出一个 Shell 脚本的系列教程。</p></blockquote><h3 id="尝试运行代码"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#尝试运行代码"><span class="icon icon-link"></span></a>尝试运行代码</h3><p>现在，让我们借助 <code>cargo run</code> 命令来尝试运行一下这段代码：</p><p><img src="https://i.loli.net/2021/02/16/Y2B4Q6eqKDgXWMl.gif" alt=""/></p><h2 id="生成一个保密数字"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#生成一个保密数字"><span class="icon icon-link"></span></a>生成一个保密数字</h2><p>解决了接收用户输入的数字之后，我们需要生成一个保密数字来供玩家进行猜测。为了保证一定的可玩性，并使每局游戏都有不同的体验，这个生成的保密数字将会是随机的。</p><h3 id="引入-rand-包"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#引入-rand-包"><span class="icon icon-link"></span></a>引入 rand 包</h3><p>Rust 团队并没有把类似的随机数字生成功能内置到标准库中，而是选择将它作为 rand 包（rand crate）提供给用户。</p><blockquote><p>注意：Rust 中包（crate）代表了一系列源代码文件的集合。我们当前构建的项目是一个用于生成可执行程序的二进制包（binary crate），而我们引入<code>rand</code>包则是一个用于复用功能的库包（libray crate，代码包）。</p></blockquote><p>要使用第三方 <code>crate</code> ，我们需要在 <code>Cargo.toml</code> 文件中加入依赖：</p><div class="__dumi-default-code-block"><pre class="prism-code language-toml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">...</span></div><div class="token-line"><span class="token plain">[dependencies]</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">rand = &quot;0.3.14&quot;</span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><p>在 <code>Cargo.toml</code> 文件中，从一个标题到下一个标题之间的所有内容都属于同一区域。这里的<code>[denpendencies]</code>区域被用来声明项目中需要用到的全部依赖包及其版本号。</p><blockquote><p>书中的版本号比较老，vscode crates 插件提示了版本 ❌</p><img src="https://i.loli.net/2021/02/16/twSxVq1CYBWpoyr.png" style="zoom:50%"/><p>我们点击任意版本即可选择该版本作为我们依赖的版本，点击圆括号内的 docs 便可跳转到库文档。</p></blockquote><p>我们先不修改任何代码，直接重新构建这个项目：</p><p><img src="https://i.loli.net/2021/02/16/e5agAks2ftmPqcD.gif" alt=""/></p><p>现在，我们的程序有了一个外部依赖，Cargo 可以从注册表（registry）中获取所有可用库的最新版本信息，而这些信息通常是从<a target="_blank" rel="noopener noreferrer" href="https://cartes.io/">cartes.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上拷贝过来的。</p><blockquote><p>cates.io 在 Rust 生态中是人们用于分享各种各样开源 Rust 项目的网站。</p></blockquote><p>现在，如果你没有做出任何改变，立即重新运行 <code>cargo build</code>，那么只会有 Finished 提示。Cargo 会自动分析当前已经下载或编译过的内容，并跳过无需重复的步骤。</p><p><img src="https://i.loli.net/2021/02/16/NO8pB7snIH54wlg.gif" alt=""/></p><h3 id="生成一个随机数"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#生成一个随机数"><span class="icon icon-link"></span></a>生成一个随机数</h3><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> use rand::Rng;</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain">use std::io;</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">fn main() {</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   println!(&quot;Guess the number!&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   let secret_number = rand::thread_rng().gen_range(1..101);</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   println!(&quot;The secret number is: {}&quot;, secret_number);</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   println!(&quot;Please input your guess.&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   let mut guess = String::new();</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   io::stdin()</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       .read_line(&amp;mut guess)</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       .expect(&quot;Failded to read line&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   println!(&quot;You guessed: {}&quot;, guess);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain">}</span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><ul><li>我们额外增加了一行 <code>use</code> 语句：<code>use rand::Rng</code>。这里的 Rng 是一个 trait（特征），它定义了随机数生成器需要实现的方法集合。为了使用这些方法，我们需要显式地将它引入当前的作用域中。</li><li><code>rand::thread_rng()</code> 会返回一个特定的随机数生成器。随后我们调用这个生成器的<code>gen_range</code>方法。</li><li><code>gen_range</code> 方法是在刚刚引入作用域的 <code>Rng</code> trait 中定义的，它接收一个 Range 类型（<code>1..100</code>）的值作为参数，并生成一个范围在两者之前的随机数。</li></ul><blockquote><p>提醒：书中的 <code>gen_range</code> 接收的是两个参数，读到时不要奇怪，版本不一样而已。</p></blockquote><blockquote><p>值得指出的是，<code>gen_range</code>生成的随机数空间包含下限但不包含上限。——做人呢，也是这样，要有底线，但不要给自己设上限。</p></blockquote><p>使用第三方包，不可避免要频繁查看文档。你可以去官方文档看，这没什么问题。但是你也可以借助<code>cargo doc --open</code> 命令在本地构建一份有关所有依赖的文档，并自动地在浏览器中将文档打来来供你查阅：</p><p><img src="https://i.loli.net/2021/02/16/1YQ6AIGnlrXwqmO.gif" alt=""/></p><p>上面代码中，我们将保密数字打印出来，只是为了调试，之后会删掉这段代码。</p><h2 id="比较猜测数字与保密数字"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#比较猜测数字与保密数字"><span class="icon icon-link"></span></a>比较猜测数字与保密数字</h2><p>现在，我们有了一个随机生成的保密数字，还有一个用户输入的猜测数字。接下来我们将比较这两个数字。</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">use rand::Rng;</span></div><div class="token-line"><span class="token plain"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> use std::cmp::Ordering;</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain">use std::io;</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">fn main() {</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   println!(&quot;Guess the number!&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   let secret_number = rand::thread_rng().gen_range(1..101);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   println!(&quot;Please input your guess.&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   let mut guess = String::new();</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   io::stdin()</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       .read_line(&amp;mut guess)</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       .expect(&quot;Failded to read line&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   println!(&quot;You guessed: {}&quot;, guess);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   match guess.cmp(&amp;secret_number) {</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">       Ordering::Less =&gt; println!(&quot;Too small!&quot;),</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">       Ordering::Greater =&gt; println!(&quot;Too big!&quot;),</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">       Ordering::Equal =&gt; println!(&quot;You win!&quot;),</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   }</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain">}</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><ul><li>我们从标准库中引入了 <code>std::cmp::Ordering</code> 类型。与 Result 相同，Ordering 也是一个枚举类型，它拥有<code>Less</code>、<code>Greater</code>、<code>Equal</code> 这 3 个变体。（cmp 是 compare 的缩写）</li><li><code>match</code> 表达式由由数个分支（arm）组成，每个分支都包含一个用于匹配的模式（pattern），以及匹配成功后要执行的相应代码。</li></ul><blockquote><p>Rust 中的<code>match</code>结构及模式是一类非常强大的工具，它们提供了依据不同条件执行不同代码的能力（类似其他语言的<code>switch</code>），并能够确保你不会遗漏任何分支条件。</p></blockquote><p>上面这段代码，目前是无法通过编译的：</p><img src="https://i.loli.net/2021/02/16/jFrSsfB9doRiuev.png" style="zoom:50%"/><p>错误原因是因为我们保存的 <code>guess</code> 变量类型是 String，保密数字是 integer 类型，不同的类型无法匹配（静态语言不存在隐式类型转换）。</p><p>为了正常进行比较操作，我们需要将程序中读取的输入从 String 类型转换为数值类型：</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">use rand::Rng;</span></div><div class="token-line"><span class="token plain">use std::cmp::Ordering;</span></div><div class="token-line"><span class="token plain">use std::io;</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">fn main() {</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   println!(&quot;Guess the number!&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   let secret_number = rand::thread_rng().gen_range(1..101);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   println!(&quot;Please input your guess.&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   let mut guess = String::new();</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   io::stdin()</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       .read_line(&amp;mut guess)</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       .expect(&quot;Failded to read line&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   let guess: i32 = guess.trim().parse().expect(&quot;Please type a number&quot;);</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   println!(&quot;You guessed: {}&quot;, guess);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   match guess.cmp(&amp;secret_number) {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       Ordering::Less =&gt; println!(&quot;Too small!&quot;),</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       Ordering::Greater =&gt; println!(&quot;Too big!&quot;),</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       Ordering::Equal =&gt; println!(&quot;You win!&quot;),</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain">}</span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><ul><li><p>我们这里创建一个新的不可变变量<code>guess</code>，虽然和前面的同名，但这是有效的，Rust 允许使用同名的新变量 guess 来隐藏（shadow）旧变量的值。这一特性通常被用在需要转换值类型的场景中，它在本例中允许我们重用 guess 这个变量名，而无须创造出 guess_str 之类不同的名字。</p></li><li><p><code>guess.trim()</code> 是为了删除首尾所有空白字符。</p></li><li><p>字符串的 <code>parse</code> 方法会尝试将当前的字符串解析为某种数值。由于这个方法可以处理不同的数值类型，所以需要我们通过语句<code>let guess: i32</code> 来显式地声明我们需要的数值类型。</p></li></ul><p>现在我们重新 Run 一下我们的程序：</p><p><img src="https://i.loli.net/2021/02/16/TUxVln6pyYwH7E5.gif" alt=""/></p><p>这个游戏已经大体成型了，但玩家只能做出一次猜测，这显然是不够的，接下来，我们会加入一个循环来完善这个游戏。</p><h2 id="使用循环来实现多次猜测"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#使用循环来实现多次猜测"><span class="icon icon-link"></span></a>使用循环来实现多次猜测</h2><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">use rand::Rng;</span></div><div class="token-line"><span class="token plain">use std::cmp::Ordering;</span></div><div class="token-line"><span class="token plain">use std::io;</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">fn main() {</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   println!(&quot;Guess the number!&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   // `..` 语法是标准库中提供的 Range</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   let secret_number = rand::thread_rng().gen_range(1..101);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   loop {</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       println!(&quot;Please input your guess.&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       let mut guess = String::new();</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       io::stdin()</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">           .read_line(&amp;mut guess)</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">           .expect(&quot;Failded to read line&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       let guess: i32 = guess.trim().parse().expect(&quot;Please type a number&quot;);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       println!(&quot;You guessed: {}&quot;, guess);</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       match guess.cmp(&amp;secret_number) {</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">           Ordering::Less =&gt; println!(&quot;Too small!&quot;),</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">           Ordering::Greater =&gt; println!(&quot;Too big!&quot;),</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">           Ordering::Equal =&gt; {</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">               println!(&quot;You win!&quot;);</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">               break;</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">           }</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       }</span></div><div class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   }</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain">}</span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><ul><li>我们将提示用户做出猜测决定之后的所有内容都移动到了 <code>loop</code> 中。在 Rust 中，<code>loop</code> 关键字会创建一个无限循环。</li><li>我们还给程序增加了一条<code>break</code>语句，使得玩家在猜对数字后能够正常退出游戏。</li></ul><p>运行程序，玩家猜对数字，输出**You Win!**后，会退出程序：</p><p><img src="https://i.loli.net/2021/02/16/9kmWNXKcBVUDJ4v.gif" alt=""/></p><h2 id="处理非法输入"><a aria-hidden="true" tabindex="-1" href="/blog/rust/rust 编写猜数游戏#处理非法输入"><span class="icon icon-link"></span></a>处理非法输入</h2><p>在转换 <code>guess</code> 字符串为 <code>number</code> 类型是，我们使用 <code>expect(&quot;Please type a number&quot;)</code>来处理可能出现的错误，我们尝试输入一个非 <code>number</code> 类型的值运行一下：</p><p><img src="https://i.loli.net/2021/02/16/SQFEs4NBo3fGMcX.gif" alt=""/></p><p>用户如果想要重新开始游戏，需要重启程序，这很明显，用户体验挺差的。为了改善游戏的可玩性，我们可以在用户输入了一个非数字数据时简单地忽略这次猜测行为，并使用户可以继续进行猜测，从而避免程序发生崩溃。</p><div class="__dumi-default-code-block"><pre class="prism-code language-rust"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">use rand::Rng;</span></div><div class="token-line"><span class="token plain">use std::cmp::Ordering;</span></div><div class="token-line"><span class="token plain">use std::io;</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">fn main() {</span></div><div class="token-line"><span class="token plain">    println!(&quot;Guess the number!&quot;);</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    // `..` 语法是标准库中提供的 Range</span></div><div class="token-line"><span class="token plain">    let secret_number = rand::thread_rng().gen_range(1..101);</span></div><div class="token-line"><span class="token plain">    loop {</span></div><div class="token-line"><span class="token plain">        println!(&quot;Please input your guess.&quot;);</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        let mut guess = String::new();</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        io::stdin()</span></div><div class="token-line"><span class="token plain">            .read_line(&amp;mut guess)</span></div><div class="token-line"><span class="token plain">            .expect(&quot;Failded to read line&quot;);</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        let guess: i32 = match guess.trim().parse() {</span></div><div class="token-line"><span class="token plain">            Ok(num) =&gt; num,</span></div><div class="token-line"><span class="token plain">            Err(_) =&gt; {</span></div><div class="token-line"><span class="token plain">              println!(&quot;Please type a number!&quot;);</span></div><div class="token-line"><span class="token plain">              continue;</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">        };</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        println!(&quot;You guessed: {}&quot;, guess);</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        match guess.cmp(&amp;secret_number) {</span></div><div class="token-line"><span class="token plain">            Ordering::Less =&gt; println!(&quot;Too small!&quot;),</span></div><div class="token-line"><span class="token plain">            Ordering::Greater =&gt; println!(&quot;Too big!&quot;),</span></div><div class="token-line"><span class="token plain">            Ordering::Equal =&gt; {</span></div><div class="token-line"><span class="token plain">                println!(&quot;You win!&quot;);</span></div><div class="token-line"><span class="token plain">                break;</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">        }</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><ul><li>我们使用了 <code>match</code> 表达式来替换之前的 <code>expect</code> 方法，这是我们处理错误行为的一种管用手段。</li><li><code>parse</code>会返回一个 Result 类型，而<code>Result</code>类型则包含了<code>Ok</code>与<code>Err</code>两个变体。</li></ul><p>万事具备，让我们运行这个项目试试看：</p><p><img src="https://i.loli.net/2021/02/16/ytXGWMKFJD9aZQI.gif" alt=""/></p><blockquote><p>本文部分内容摘自 《Rust 权威指南》</p></blockquote><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f43972a616b4a4f853e616cc749f680~tplv-k3u1fbpfcp-zoom-1.image" style="zoom:50%"/><p>寻了一圈，未得一个 Rust 交流群，自己组了一个，欢迎大佬加入：</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/02c2c082db1d4cd4b4b3d183be97968b~tplv-k3u1fbpfcp-watermark.image" style="zoom:50%"/><blockquote><p>涂鸦智能大量优质 HC，欢迎大家加入，需要内推加我微信 yang_jun_ning，或直接发简历到邮箱 <a href="/blog/rust/mailto:youngjuning@aliyun.com">youngjuning@aliyun.com</a></p></blockquote></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/youngjuning.github.io/edit/main/docs/blog/rust/Rust 编写猜数游戏.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">3/8/2021 06:10:16</span></div></div><div class="ant-back-top"></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/umi.2ce4b6b7.js"></script>
  </body>
</html>
