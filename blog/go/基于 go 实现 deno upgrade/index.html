<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta name="title" content="洛竹的官方网站" />
    <meta name="keywords" content="react, javascript, typescript" />
    <meta name="description" content="怕什么真理无穷，进一寸有一寸的欢喜" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://i.loli.net/2021/01/07/LkH3VM6oBnIuFNi.png"
    />
    <link rel="stylesheet" href="/umi.26fedac2.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.4.2
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.includes(e) ? e : r[0]
        );
      })();
    </script>
    <title>基于 Go 实现 Deno upgrade</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/blog/go/基于 go 实现 deno upgrade" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;https://i.loli.net/2021/01/07/LkH3VM6oBnIuFNi.png&#x27;)" href="/">洛竹的官方网站</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a aria-current="page" class="active" href="/blog">博客</a></span><span><a href="/awesome">收藏</a></span><span><a href="/about">关于</a></span><span><a href="/leetcode">算法</a></span><span><a href="/links">友链</a></span><span>洛竹文档⤵️<ul><li><a href="/cobra"> Cobra</a></li><li><a href="/viper"> Viper</a></li><li><a href="/github-actions"> GitHub Actions</a></li></ul></span><span><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/user/325111174662855/posts">掘金<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><span><a target="_blank" rel="noopener noreferrer" href="https://www.zhihu.com/people/yangjunning">知乎<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><ul><li><a target="_blank" rel="noopener noreferrer" href="https://www.zhihu.com/column/c_1341734653628149760">前端早茶馆<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/youngjuning.github.io">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://i.loli.net/2021/01/07/LkH3VM6oBnIuFNi.png&#x27;)" href="/"></a><h1>洛竹的官方网站</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a aria-current="page" class="active" href="/blog">博客</a></li><li><a href="/awesome">收藏</a></li><li><a href="/about">关于</a></li><li><a href="/leetcode">算法</a></li><li><a href="/links">友链</a></li><li>洛竹文档⤵️<ul><li><a href="/cobra"> Cobra</a></li><li><a href="/viper"> Viper</a></li><li><a href="/github-actions"> GitHub Actions</a></li></ul></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/user/325111174662855/posts">掘金<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.zhihu.com/people/yangjunning">知乎<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><ul><li><a target="_blank" rel="noopener noreferrer" href="https://www.zhihu.com/column/c_1341734653628149760">前端早茶馆<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/youngjuning.github.io">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/blog">Less is more</a></li><li><a href="/blog/deno">Deno</a><ul><li><a href="/blog/deno/deno git-hub action 源码解析"><span>Deno GitHub Action 源码解析</span></a></li><li><a href="/blog/deno/向 deno 学习脚本的管理"><span>向 Deno 学习脚本的管理</span></a></li></ul></li><li><a href="/blog/devops">Devops</a><ul><li><a href="/blog/devops/玩转 github actions"><span>玩转 GitHub Actions</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog/go">Go</a><ul><li><a href="/blog/go/go语法学习笔记"><span>Go 语法学习笔记</span></a></li><li><a aria-current="page" class="active" href="/blog/go/基于 go 实现 deno upgrade"><span>基于 Go 实现 Deno upgrade</span></a></li><li><a href="/blog/go/极速入门 go 并爬取掘金专栏"><span>极速入门 Go 并爬取掘金专栏</span></a></li></ul></li><li><a href="/blog/javascript">Javascript</a><ul><li><a href="/blog/javascript/图解google-v8-学习笔记"><span>图解 Google V8 学习笔记</span></a></li></ul></li><li><a href="/blog/others">Others</a><ul><li><a href="/blog/others/程序员购钻指南"><span>程序员购钻指南：钻戒值不值得买？怎么买？</span></a></li></ul></li><li><a href="/blog/react-native">react-native</a><ul><li><a href="/blog/react-native/flutter-vs-react-native–what-to-choose-in-2021"><span>2021 Flutter 完胜 React Native ?</span></a></li><li><a href="/blog/react-native/react native 调试最佳实践"><span>React Native 调试最佳实践</span></a></li><li><a href="/blog/react-native/使用jest和enzyme进行react native单元测试"><span>使用Jest和Enzyme进行React Native单元测试</span></a></li><li><a href="/blog/react-native/当我们在聊 rn 时，我们在谈什么"><span>当我们在聊 RN 时，我们在聊什么|技术点评</span></a></li><li><a href="/blog/react-native/给 react native 库添加 example"><span>给 React Native 库添加 Example</span></a></li></ul></li><li><a href="/blog/rust">Rust</a><ul><li><a href="/blog/rust/一个番茄钟入门 rust"><span>一个番茄钟入门 Rust</span></a></li><li><a href="/blog/rust/rust 语法学习"><span>Rust 语法学习</span></a></li><li><a href="/blog/rust/rust 编写猜数游戏"><span>Rust 编写猜数游戏</span></a></li><li><a href="/blog/rust/为什么rust需要局部变量隐藏"><span>为什么 Rust 需要局部变量隐藏</span></a></li><li><a href="/blog/rust/rust 在 web 领域的应用"><span>Rust 在 Web 领域的应用</span></a></li></ul></li><li><a href="/blog/tools">Tools</a><ul><li><a href="/blog/tools/发布一个 homebrew 包"><span>发布一个 Homebrew 包</span></a></li><li><a href="/blog/tools/我的mac开发环境"><span>我的 Mac 开发环境</span></a></li></ul></li><li><a href="/blog/typescript">Typescript</a><ul><li><a href="/blog/typescript/向微软官方贡献 @types 包"><span>向微软官方贡献 @types 包</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="获取最新版本" data-depth="2"><a href="/blog/go/基于 go 实现 deno upgrade#获取最新版本"><span>获取最新版本</span></a></li><li title="版本检测" data-depth="2"><a href="/blog/go/基于 go 实现 deno upgrade#版本检测"><span>版本检测</span></a></li><li title="cobra 实现 upgrade" data-depth="2"><a href="/blog/go/基于 go 实现 deno upgrade#cobra-实现-upgrade"><span>cobra 实现 upgrade</span></a></li><li title="强制更新方案" data-depth="2"><a href="/blog/go/基于 go 实现 deno upgrade#强制更新方案"><span>强制更新方案</span></a></li><li title="go-release 的诞生" data-depth="2"><a href="/blog/go/基于 go 实现 deno upgrade#go-release-的诞生"><span>go-release 的诞生</span></a></li></ul><div class="__dumi-default-layout-content"><span class="__dumi-default-badge">掘金专栏</span><div style="display:flex;justify-content:center"><img src="https://i.loli.net/2021/02/03/h9bMeX3w2ZBYNoQ.png" width="70%"/></div><div class="markdown"><p>书接上篇，我在<a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/6924465443704930318">向 Deno 学习优秀的脚本管理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中向大家介绍了 Deno 是如何管理它的安装包的——以 Github release 的形式发布、执行编写好的 shell 脚本安装程序以及基于 tags 的版本管理。有版本管理就会有更新的需求，本文就是在研读了 Deno 的 <code>upgrade</code> 命令后使用 Go 语言实现了自己的 upgrade 命令。</p><h2 id="获取最新版本"><a aria-hidden="true" tabindex="-1" href="/blog/go/基于 go 实现 deno upgrade#获取最新版本"><span class="icon icon-link"></span></a>获取最新版本</h2><p>我们先来看下 Deno 的源码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-rust"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">use deno_runtime::deno_fetch::reqwest::Client;</span></div><div class="token-line"><span class="token plain">const RELEASE_URL: &amp;str = &quot;https://github.com/denoland/deno/releases&quot;;</span></div><div class="token-line"><span class="token plain">...</span></div><div class="token-line"><span class="token plain">async fn get_latest_release_version(</span></div><div class="token-line"><span class="token plain">  client: &amp;Client,</span></div><div class="token-line"><span class="token plain">) -&gt; Result&lt;String, AnyError&gt; {</span></div><div class="token-line"><span class="token plain">  println!(&quot;Looking up latest version&quot;);</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  let res = client</span></div><div class="token-line"><span class="token plain">    .get(&amp;format!(&quot;{}/latest&quot;, RELEASE_URL))</span></div><div class="token-line"><span class="token plain">    .send()</span></div><div class="token-line"><span class="token plain">    .await?;</span></div><div class="token-line"><span class="token plain">  let version = res.url().path_segments().unwrap().last().unwrap();</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  Ok(version.replace(&quot;v&quot;, &quot;&quot;))</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><p>分析出以上代码做了以下几件事：</p><ol><li>由于是异步函数，用 <code>println</code> 函数提示正在查找新版本</li><li>使用 <code>GET</code> 方式请求 <code>https://github.com/denoland/deno/releases/latest</code></li><li>由于 <code>https://github.com/denoland/deno/releases/latest</code> 会重定向到最新的 release <code>https://github.com/denoland/deno/releases/tag/v1.7.1</code>，通过一顿字符串操作我们便取出了 <code>v1.7.1</code></li><li>调用字符串的 <code>replace</code> 方法替换 <code>v</code> 为 <code>&quot;&quot;</code> 得到版本号</li></ol><p>让我们用 Go 来实现它：</p><blockquote><p>代码看起来差不多，比如模板字符串写法、字符串处理</p></blockquote><div class="__dumi-default-code-block"><pre class="prism-code language-go"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">package</span><span class="token plain"> release</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token string">&quot;net/http&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token string">&quot;strings&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">func</span><span class="token plain"> </span><span class="token function">getLatestVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	releaseURL </span><span class="token operator">:=</span><span class="token plain"> fmt</span><span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/%s/%s/releases/latest&quot;</span><span class="token punctuation">,</span><span class="token plain"> user</span><span class="token punctuation">,</span><span class="token plain"> repo</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	resp</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token operator">:=</span><span class="token plain"> http</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token plain">releaseURL</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">defer</span><span class="token plain"> resp</span><span class="token punctuation">.</span><span class="token plain">Body</span><span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// 为了防止内存泄漏</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">	pathArr </span><span class="token operator">:=</span><span class="token plain"> strings</span><span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token plain">resp</span><span class="token punctuation">.</span><span class="token plain">Request</span><span class="token punctuation">.</span><span class="token plain">URL</span><span class="token punctuation">.</span><span class="token plain">Path</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	latest </span><span class="token operator">:=</span><span class="token plain"> strings</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token plain">pathArr</span><span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token plain">pathArr</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">return</span><span class="token plain"> latest</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><h2 id="版本检测"><a aria-hidden="true" tabindex="-1" href="/blog/go/基于 go 实现 deno upgrade#版本检测"><span class="icon icon-link"></span></a>版本检测</h2><p>版本的处理少不了<a target="_blank" rel="noopener noreferrer" href="https://semver.org/">SemVer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。我们使用 <a target="_blank" rel="noopener noreferrer" href="https://github.com/hashicorp/go-version">go-version<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来处理版本相关工作，有了版本比较我们便可以实现一个版本检查的功能。以下代码是 我封装的 <a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/go-release">go-release<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中的一段代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-go"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">type</span><span class="token plain"> UpdateInfo </span><span class="token keyword">struct</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	IsUpdate      </span><span class="token builtin">bool</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	LatestVersion </span><span class="token builtin">string</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">func</span><span class="token plain"> </span><span class="token function">CheckUpdate</span><span class="token punctuation">(</span><span class="token plain">user </span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token plain"> repo </span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token plain"> current </span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">updateInfo </span><span class="token operator">*</span><span class="token plain">UpdateInfo</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token builtin">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	releaseURL </span><span class="token operator">:=</span><span class="token plain"> fmt</span><span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/%s/%s/releases/latest&quot;</span><span class="token punctuation">,</span><span class="token plain"> user</span><span class="token punctuation">,</span><span class="token plain"> repo</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	resp</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token operator">:=</span><span class="token plain"> http</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token plain">releaseURL</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">if</span><span class="token plain"> err </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		</span><span class="token keyword">return</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token plain"> err</span></div><div class="token-line"><span class="token plain">	</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">defer</span><span class="token plain"> resp</span><span class="token punctuation">.</span><span class="token plain">Body</span><span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">	current </span><span class="token operator">=</span><span class="token plain"> strings</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token plain">current</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	pathArr </span><span class="token operator">:=</span><span class="token plain"> strings</span><span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token plain">resp</span><span class="token punctuation">.</span><span class="token plain">Request</span><span class="token punctuation">.</span><span class="token plain">URL</span><span class="token punctuation">.</span><span class="token plain">Path</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	latest </span><span class="token operator">:=</span><span class="token plain"> strings</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token plain">pathArr</span><span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token plain">pathArr</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">	currentVersion</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token operator">:=</span><span class="token plain"> version</span><span class="token punctuation">.</span><span class="token function">NewVersion</span><span class="token punctuation">(</span><span class="token plain">current</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">if</span><span class="token plain"> err </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		</span><span class="token keyword">return</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token plain"> err</span></div><div class="token-line"><span class="token plain">	</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	latestVersion</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token operator">:=</span><span class="token plain"> version</span><span class="token punctuation">.</span><span class="token function">NewVersion</span><span class="token punctuation">(</span><span class="token plain">latest</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">if</span><span class="token plain"> err </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		</span><span class="token keyword">return</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation">,</span><span class="token plain"> err</span></div><div class="token-line"><span class="token plain">	</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	updateInfo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">UpdateInfo</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		IsUpdate</span><span class="token punctuation">:</span><span class="token plain">      currentVersion</span><span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span><span class="token plain">latestVersion</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		LatestVersion</span><span class="token punctuation">:</span><span class="token plain"> latest</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">return</span><span class="token plain"> updateInfo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><h2 id="cobra-实现-upgrade"><a aria-hidden="true" tabindex="-1" href="/blog/go/基于 go 实现 deno upgrade#cobra-实现-upgrade"><span class="icon icon-link"></span></a>cobra 实现 upgrade</h2><p>下面的代码中，我们基于 <a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/go-release">go-release<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实现了一个带 <code>upgrade</code> 命令的简易 CLI，核心逻辑便是比较本地版本是否是最新的，如果不是则安装最新的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-go"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> Version </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;0.0.1&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">func</span><span class="token plain"> </span><span class="token function">checkUpgrade</span><span class="token punctuation">(</span><span class="token plain">current </span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  fmt</span><span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Looking up latest version&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	update</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token operator">:=</span><span class="token plain"> release</span><span class="token punctuation">.</span><span class="token function">CheckUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;youngjuning&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;tpc&quot;</span><span class="token punctuation">,</span><span class="token plain"> current</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">if</span><span class="token plain"> err </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		</span><span class="token function">panic</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">if</span><span class="token plain"> update</span><span class="token punctuation">.</span><span class="token plain">IsUpdate </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		fmt</span><span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Found latest version %v \n&quot;</span><span class="token punctuation">,</span><span class="token plain"> update</span><span class="token punctuation">.</span><span class="token plain">LatestVersion</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		sh</span><span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">&quot;bash&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;curl -fsSL https://raw.githubusercontent.com/youngjuning/tpc/main/install.sh | sh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		fmt</span><span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Local version %v is the most recent release \n&quot;</span><span class="token punctuation">,</span><span class="token plain"> current</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> rootCmd </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">cobra</span><span class="token punctuation">.</span><span class="token plain">Command</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	Use</span><span class="token punctuation">:</span><span class="token plain">     </span><span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	Version</span><span class="token punctuation">:</span><span class="token plain"> Version</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> cmdUpgrade </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">cobra</span><span class="token punctuation">.</span><span class="token plain">Command</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	Use</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;upgrade&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	Run</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token plain">cmd </span><span class="token operator">*</span><span class="token plain">cobra</span><span class="token punctuation">.</span><span class="token plain">Command</span><span class="token punctuation">,</span><span class="token plain"> args </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		</span><span class="token function">checkUpgrade</span><span class="token punctuation">(</span><span class="token plain">Version</span><span class="token punctuation">,</span><span class="token plain"> force</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">func</span><span class="token plain"> </span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	rootCmd</span><span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span><span class="token plain">cmdUpgrade</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	rootCmd</span><span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><h2 id="强制更新方案"><a aria-hidden="true" tabindex="-1" href="/blog/go/基于 go 实现 deno upgrade#强制更新方案"><span class="icon icon-link"></span></a>强制更新方案</h2><p><a target="_blank" rel="noopener noreferrer" href="https://kohpoll.github.io/blog/2017/06/06/the-right-way-to-do-update-check-in-cli-tool/">Node.js 命令行工具检查更新的正确姿势<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 对这个问题做了很深入的研究并实现了 Node 版的工具。核心逻辑就是每次执行命令时异步去执行检查更新。这句话翻译成 Go 就是用协程去执行检查更新的动作，这样执行命令还是会立马得到反馈，程序则会在后台执行检查更新，当检测到有新版本则强制更新。</p><blockquote><p>完整代码在<a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/go-release/tree/main/example">go-release/example<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，对 Cobra 不熟悉的同学可以看一下 <a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/6924541628031959047">Cobra 中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></blockquote><blockquote><p>执行 shell 命令推荐 <a target="_blank" rel="noopener noreferrer" href="https://github.com/codeskyblue/go-sh">go-sh<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它对 exec 包做了封装，提供了更好地使用体验（ PS：还不是因为我菜）</p></blockquote><div class="__dumi-default-code-block"><pre class="prism-code language-go"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// rootCmd 代表没有调用子命令时的基础命令</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> rootCmd </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">cobra</span><span class="token punctuation">.</span><span class="token plain">Command</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	Use</span><span class="token punctuation">:</span><span class="token plain">     </span><span class="token string">&quot;tpc&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	Version</span><span class="token punctuation">:</span><span class="token plain"> Version</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	Run</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token plain">cmd </span><span class="token operator">*</span><span class="token plain">cobra</span><span class="token punctuation">.</span><span class="token plain">Command</span><span class="token punctuation">,</span><span class="token plain"> args </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		sh</span><span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">&quot;tpc&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;-h&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 每次执行完命令后去执行检查更新，Start 表示不阻塞原来的任务，还有一个 Run 方法则是会阻塞</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	PersistentPostRun</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token plain">cmd </span><span class="token operator">*</span><span class="token plain">cobra</span><span class="token punctuation">.</span><span class="token plain">Command</span><span class="token punctuation">,</span><span class="token plain"> args </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">		sh</span><span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">&quot;bash&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;tpc upgrade --force=false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div></pre></div><h2 id="go-release-的诞生"><a aria-hidden="true" tabindex="-1" href="/blog/go/基于 go 实现 deno upgrade#go-release-的诞生"><span class="icon icon-link"></span></a>go-release 的诞生</h2><blockquote><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/go-release">go-release<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 核心代码翻译自 Deno 的 <code>upgrade</code>，开源项目，点赞是我维护的动力，在此求个 Star。</p></blockquote><p>go-release 的诞生源自我工作中要实现一个 CLI 工具的版本管理功能，由于是个菜鸟，中间遇到了各种各样的困难，幸得大佬无私地解答，才能很快实现了这么一个功能，在此鸣谢：</p><p><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/user/3175045313873943">林小帅<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p><p><img src="https://i.loli.net/2021/02/04/TdKuPXU9Acns5pa.jpg" alt=""/></p><p><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/book/6844733833401597966">漫画 Go 语言 纯手绘版<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 作者好家伙：</p><p><img src="https://i.loli.net/2021/02/04/Uf8OFhmSJxqEpzH.jpg" alt=""/></p><p><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/user/3526889000941592">justjavac<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 大佬：</p><p><img src="https://i.loli.net/2021/02/04/RJ48jV6hSGyDuMi.jpg" alt=""/></p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/youngjuning/youngjuning.github.io/edit/main/docs/blog/go/基于 Go 实现 Deno upgrade.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">3/12/2021 08:10:58</span></div></div><div class="ant-back-top"></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/umi.89d269f8.js"></script>
  </body>
</html>
